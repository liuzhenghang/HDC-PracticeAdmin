<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>学生管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../../lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="../../css/public.css" media="all">
</head>
<body>
<fieldset class="layui-elem-field">
    <legend id="title">批次信息</legend>
    <div class="layui-field-box" id="app">
        <form class="layui-form layui-form-pane" lay-filter="practice_batch">
            <div class="layui-form-item" pane>
                <label class="layui-form-label">批次名称</label>
                <div class="layui-input-block">
                    <input type="text" name="name" required lay-verify="required" placeholder="请输入名称" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item" pane>
                <label class="layui-form-label">开始时间</label>
                <div class="layui-input-block">
                    <input id="start" type="text" name="start" required lay-verify="required" placeholder="实习计划开始时间" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item" pane>
                <label class="layui-form-label">结束时间</label>
                <div class="layui-input-block">
                    <input id="end" type="text" name="end" required lay-verify="required" placeholder="实习计划结束时间" autocomplete="off" class="layui-input">
                </div>
            </div>

            <div class="layui-form-item" pane>
                <label class="layui-form-label">展示比重</label>
                <div class="layui-input-block">
                    <input type="radio" name="displayFraction" value="1" title="展示">
                    <input type="radio" name="displayFraction" value="0" title="不展示">
                </div>
            </div>

            <div class="layui-form-item" pane>
                <label class="layui-form-label">备注</label>
                <div class="layui-input-block">
                    <textarea name="remarks" placeholder="请输入内容" class="layui-textarea"></textarea>
                </div>
            </div>
            <fieldset class="layui-elem-field">
                <legend>成绩比重</legend>
                <div class="layui-field-box">
                    <fieldset class="layui-elem-field layui-field-title">
                        <legend>成绩1</legend>
                        <div class="layui-field-box">
                            <div class="layui-inline">
                                <label class="layui-form-label">成绩备注</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="fraction1" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline" style="margin-right: 0">
                                <label class="layui-form-label">权重%</label>
                                <div class="layui-input-inline">
                                    <input type="number" name="weight1" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="layui-elem-field layui-field-title">
                        <legend>成绩2</legend>
                        <div class="layui-field-box">
                            <div class="layui-inline">
                                <label class="layui-form-label">成绩备注</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="fraction2" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">权重%</label>
                                <div class="layui-input-inline">
                                    <input type="number" name="weight2" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="layui-elem-field layui-field-title">
                        <legend>成绩3</legend>
                        <div class="layui-field-box">
                            <div class="layui-inline">
                                <label class="layui-form-label">成绩备注</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="fraction3" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">权重%</label>
                                <div class="layui-input-inline">
                                    <input type="number" name="weight3" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="layui-elem-field layui-field-title">
                        <legend>成绩4</legend>
                        <div class="layui-field-box">
                            <div class="layui-inline">
                                <label class="layui-form-label">成绩备注</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="fraction4" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">权重%</label>
                                <div class="layui-input-inline">
                                    <input type="number" name="weight4" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="layui-elem-field layui-field-title">
                        <legend>成绩5</legend>
                        <div class="layui-field-box">
                            <div class="layui-inline">
                                <label class="layui-form-label">成绩备注</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="fraction5" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">权重%</label>
                                <div class="layui-input-inline">
                                    <input type="number" name="weight5" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <fieldset class="layui-elem-field layui-field-title">
                        <legend>成绩6</legend>
                        <div class="layui-field-box">
                            <div class="layui-inline">
                                <label class="layui-form-label">成绩备注</label>
                                <div class="layui-input-inline">
                                    <input type="text" name="fraction6" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                            <div class="layui-inline">
                                <label class="layui-form-label">权重%</label>
                                <div class="layui-input-inline">
                                    <input type="number" name="weight6" required lay-verify="required" placeholder="" autocomplete="off" class="layui-input">
                                </div>
                            </div>
                        </div>
                    </fieldset>

                </div>
            </fieldset>

            <button class="layui-btn" lay-submit lay-filter="add">立即提交</button>
        </form>
    </div>
</fieldset>
</body>
<script src="../../lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
<script src="../../lib/vue.js" charset="utf-8"></script>
<script src="../../js/lay-config.js?v=2.0.0" charset="utf-8"></script>
<script>
    function getQueryVariable(variable){
        let query = window.location.search.substring(1);
        let vars = query.split("&");
        for (let i=0;i<vars.length;i++) {
            let pair = vars[i].split("=");
            if(pair[0] === variable){return pair[1];}
        }
        return false;
    }
    let url="/admin/practice/batch/add";
    let edit=null;
    layui.use(['easyAjax'], function () {
        let ajax = layui.easyAjax,
            $=layui.jquery;
        ajax.getHeader();
        function pushList(){
            layui.use(['form','laydate'], function () {
                let form = layui.form,
                    layer=layui.layer,
                    laydate=layui.laydate;
                laydate.render({
                    elem: '#start' //指定元素
                    ,type:"date"
                });
                laydate.render({
                    elem: '#end' //指定元素
                    ,type:"date"
                });
                let bid=null;
                if (edit!==null){
                    form.val("practice_batch",edit)
                    bid=edit.bid;
                    edit=null;
                }
                form.on("submit(add)",function (obj) {
                    let data=obj.field;
                    if (bid!==null){
                        data.bid=bid;
                    }
                    ajax.post(url,data,function (res) {
                        if (res){
                            console.log("需要刷新")
                        }else {
                            console.log("不需要刷新")
                        }
                        ajax.LMessageSuccess("操作成功")
                        setTimeout(function () {
                            let index = parent.layer.getFrameIndex(window.name);
                            parent.layer.close(index);
                        },500)
                    },function (err) {
                        ajax.errorMessage(err)
                    },"正在执行")
                    return false;
                })
            })
        }
        if (getQueryVariable("edit")){
            let bid=getQueryVariable("edit");
            url="/admin/practice/batch/update";
            ajax.post("/admin/practice/batch/get/"+bid,null,function (res) {
                edit=res;
                $("#title").html("编辑批次："+res.name+"："+bid);
                pushList();
            },function (err) {
                ajax.errorMessage(err);
            },"正在拉取数据")
        }else {
            $("#title").html("添加批次")
            pushList();
        }


    })



</script>
</html>